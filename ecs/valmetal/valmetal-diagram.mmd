graph LR
    subgraph Farm ["ğŸšœ Farm"]
        subgraph Equipment ["Equipment"]
            HMI["ğŸ“± HMI"]
            FarmingEquip["ğŸšœ Farming<br/>Equipment"]
        end
        
        subgraph PLC ["ğŸ“Ÿ PLC"]
            subgraph RealTime ["Real-Time Control"]
                AutoProgram["âš™ï¸ Automation Program<br/>(Valmetal)"]
            end
            
            subgraph DataInterfaces ["Data Hub & Interfaces"]
                DataHub["ğŸ—„ï¸ Global Data<br/>Space"]
                RestAPI["ğŸŒ REST API"]
            end
            
            subgraph EdgeGateway ["Edge Compute & Gateway"]
                Agent["ğŸ¤– Agent<br/>(Ingeno)"]
                NodeRED["ğŸ”´ Node-RED<br/>(Ingeno)"]
                OPCServer["ğŸ”Œ OPC-UA Server"]
                BalenaEngine["ğŸ³ Balena Engine"]
            end
        end
    end

    subgraph Cloud ["â˜ï¸ Cloud"]
        subgraph SecurityGov ["ğŸ” Security, Monitoring & Governance"]
            IoTDevMgmt["ğŸ›¡ï¸ IoT Device<br/>Management"]
            IoTPolicies["ğŸ“‹ IoT Core<br/>Policies"]
            CloudWatch["ğŸ“Š CloudWatch"]
            IAM["ğŸ”‘ IAM"]
            AppConfig["âš™ï¸ App Config"]
            Cognito["ğŸ‘¤ Cognito"]
        end
        
        subgraph DataFlow ["Data Processing Pipeline"]
            subgraph Ingestion ["ğŸ“¥ Ingestion"]
                IoTCore["ğŸ“¡ IoT Core<br/>Topics"]
                IoTShadow["ğŸ‘¥ IoT Core<br/>Device Shadow"]
                IoTRules["ğŸ“ IoT Core<br/>Rules"]
            end
            
            subgraph Processing ["âš™ï¸ Processing"]
                EventBridge["ğŸŒ‰ EventBridge"]
                SQS["ğŸ“¬ SQS"]
                StepFunctions["ğŸ”„ Step Functions"]
                ECSFargate["ğŸ³ ECS Fargate"]
                Lambda["âš¡ Lambda"]
                KinesisFirehose["ğŸš° Kinesis<br/>Firehose"]
            end
            
            subgraph Storage ["ğŸ’¾ Storage"]
                S3["ğŸª£ S3"]
                Timestream["â±ï¸ Timestream"]
                DynamoDB["ğŸ—ƒï¸ DynamoDB"]
                RDS["ğŸ—„ï¸ RDS"]
            end
        end
        
        subgraph UserApps ["ğŸ“± Applications"]
            AdminWeb["ğŸ‘¨â€ğŸ’¼ Admin Web App"]
            ClientWeb["ğŸ‘¤ Client Web App"]
            ClientPWA["ğŸ“± Client PWA"]
        end
        
        subgraph Notifications ["ğŸ“¬ Notifications"]
            SNS["ğŸ“¢ SNS"]
            SES["ğŸ“§ SES"]
        end
    end

    %% Farm connections
    HMI -.->|Ethernet| PLC
    FarmingEquip -.->|I/O Module| PLC

    %% Farm to Cloud
    PLC ==>|Internet<br/>MQTT/HTTP| IoTCore

    %% Ingestion flow
    IoTCore --> IoTShadow
    IoTCore --> IoTRules
    
    %% Processing flow
    IoTRules --> EventBridge
    IoTRules --> KinesisFirehose
    EventBridge --> SQS
    EventBridge --> StepFunctions
    EventBridge --> Lambda
    
    %% Storage flow
    SQS --> ECSFargate
    StepFunctions --> ECSFargate
    Lambda --> DynamoDB
    Lambda --> Timestream
    KinesisFirehose --> S3
    
    %% ECS connections
    ECSFargate --> DynamoDB
    ECSFargate --> RDS
    ECSFargate --> Timestream
    ECSFargate --> S3
    
    %% Applications
    ECSFargate --> AdminWeb
    ECSFargate --> ClientWeb
    ECSFargate --> ClientPWA
    
    %% Notifications
    ECSFargate --> SNS
    ECSFargate --> SES

    %% Styling
    classDef farmStyle fill:#E8F5E8,stroke:#2E7D32,stroke-width:2px
    classDef securityStyle fill:#FFF3E0,stroke:#F57C00,stroke-width:2px
    classDef ingestionStyle fill:#E3F2FD,stroke:#1976D2,stroke-width:2px
    classDef processingStyle fill:#FCE4EC,stroke:#C2185B,stroke-width:2px
    classDef storageStyle fill:#F3E5F5,stroke:#7B1FA2,stroke-width:2px
    classDef appStyle fill:#E8F5E8,stroke:#388E3C,stroke-width:2px
    classDef notifStyle fill:#FFF8E1,stroke:#FBC02D,stroke-width:2px
    
    class Farm,Equipment,PLC,RealTime,DataInterfaces,EdgeGateway farmStyle
    class SecurityGov securityStyle
    class Ingestion ingestionStyle
    class Processing processingStyle
    class Storage storageStyle
    class UserApps appStyle
    class Notifications notifStyle